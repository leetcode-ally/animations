<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Motion Canvas Player</title>
    <script type="module" crossorigin src="./main.js"></script>
    <link rel="stylesheet" crossorigin href="./style.css">
  </head>
  <body>
    <div id="main-screen"></div>

    <div class="btn-list" id="btn-list">
      <button class="btn-prev" id="previous">Prev</button>
      <button class="btn-next" id="next">Next</button>
    </div>
    <script>
      const screenBundleMap = {
        intro: "/src/bundles/intro/src/index.js",
        array: "/src/bundles/array/src/index.js",
        stack: "/src/bundles/stack/src/index.js",
        binary: "./src/bundles/binarysearch/src/index.js",
      };

      // get screen name from url params
      const urlParams = new URLSearchParams(window.location.search);
      const screen = urlParams.get("screen");

      const mainScreen = document.querySelector("#main-screen");

      mainScreen.innerHTML = `<motion-canvas-player
          src="${screenBundleMap[screen]}"
          style="aspect-ratio: 16 / 9"
        >
        </motion-canvas-player>`;

      const player = document.querySelector("motion-canvas-player");
      const btnList = document.querySelector("#btn-list");
      const previous = document.querySelector("#previous");
      const next = document.querySelector("#next");

      let init = true;

      btnList.addEventListener("click", (event) => {
        init = false;
      });

      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.attributeName === "data-overlay") {
            if (!init && player.hasAttribute("data-overlay")) {
              // indicator.textContent = "playing";
              next.disabled = true;
              next.classList.add("disabled");
              previous.disabled = true;
              previous.classList.add("disabled");
            } else {
              // indicator.textContent = "paused";
              next.disabled = false;
              next.classList.remove("disabled");
              previous.disabled = false;
              previous.classList.remove("disabled");
            }
          }
        });
      });

      // Start observing the player element for attribute changes
      observer.observe(player, {
        attributes: true,
        attributeFilter: ["data-overlay"],
      });

      if (player.hasAttribute("data-overlay")) {
        // indicator.textContent = "playing";
        next.disabled = true;
        next.classList.add("disabled");
        previous.disabled = true;
        previous.classList.add("disabled");
      } else {
        // indicator.textContent = "paused";
        next.disabled = false;
        next.classList.remove("disabled");
        previous.disabled = false;
        previous.classList.remove("disabled");
      }
    </script>
  </body>
</html>
